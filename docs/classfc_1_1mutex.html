<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BitShares-Core: fc::mutex Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BitShares-Core
   &#160;<span id="projectnumber">6.1.0</span>
   </div>
   <div id="projectbrief">BitShares blockchain implementation and command-line interface software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacefc.html">fc</a></li><li class="navelem"><a class="el" href="classfc_1_1mutex.html">mutex</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classfc_1_1mutex-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">fc::mutex Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>mutex  
 <a href="classfc_1_1mutex.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="mutex_8hpp_source.html">mutex.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac22379059fe8687ec5beb098ca606060"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfc_1_1mutex.html#ac22379059fe8687ec5beb098ca606060">mutex</a> ()</td></tr>
<tr class="separator:ac22379059fe8687ec5beb098ca606060"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a135d5ee5d0422e223d0956caa928761b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfc_1_1mutex.html#a135d5ee5d0422e223d0956caa928761b">~mutex</a> ()</td></tr>
<tr class="separator:a135d5ee5d0422e223d0956caa928761b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ee1f956f3714d91df52a736b496d993"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfc_1_1mutex.html#a6ee1f956f3714d91df52a736b496d993">try_lock</a> ()</td></tr>
<tr class="separator:a6ee1f956f3714d91df52a736b496d993"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a992f444812ae4faebe485f3131d8a10b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfc_1_1mutex.html#a992f444812ae4faebe485f3131d8a10b">try_lock_for</a> (const <a class="el" href="classfc_1_1microseconds.html">microseconds</a> &amp;rel_time)</td></tr>
<tr class="separator:a992f444812ae4faebe485f3131d8a10b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c203a83ae29c8566a5bbbc07bc33931"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfc_1_1mutex.html#a6c203a83ae29c8566a5bbbc07bc33931">try_lock_until</a> (const <a class="el" href="classfc_1_1time__point.html">time_point</a> &amp;abs_time)</td></tr>
<tr class="separator:a6c203a83ae29c8566a5bbbc07bc33931"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad27acb6182f2c9999c2ac2d2463077c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfc_1_1mutex.html#ad27acb6182f2c9999c2ac2d2463077c7">lock</a> ()</td></tr>
<tr class="separator:ad27acb6182f2c9999c2ac2d2463077c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9631571a059b48fe90022923795bfab4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfc_1_1mutex.html#a9631571a059b48fe90022923795bfab4">unlock</a> ()</td></tr>
<tr class="separator:a9631571a059b48fe90022923795bfab4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>mutex </p>
<p>This mutex has an advantage over boost::mutex in that it does not involve any system calls, even in contention.</p>
<p>Uncontensted access is a simple compare and swap, no delay.</p>
<p>Contested access by different fibers in the same thread simply yields the thread until the lock is available. Actual delay is subject to the cooperative nature of other tasks in the fiber's thread.</p>
<p>Contested access by different threads requires a spin lock while the task is enqueued. Because the enqueue action is well-defined and 'short-lived' time spent 'spinning' should be minimal.</p>
<p>Cooperatively multi-tasked code must still worry about reentrancy. Suppose you have a thread sending a message across a socket, the socket members are thread safe, but the <code>write_message()</code> operation is not rentrant because the context could yield while waiting for a partial write to complete.</p>
<p>If while it has yielded another task in the same thread attempts to write a second message then you will get garbage out as both fibers take turns writing parts of their messages out of the socket.</p>
<p>Example problem: </p><div class="fragment"><div class="line"><a class="code" href="namespacefc.html#a009206175c2cd7ef2c0fde6c4ae061b5">async</a>(write_message);</div><div class="line"><a class="code" href="namespacefc.html#a009206175c2cd7ef2c0fde6c4ae061b5">async</a>(write_message);</div><div class="line"><span class="keywordtype">void</span> write_message() {</div><div class="line">  sock-&gt;write(part1); <span class="comment">// may yield</span></div><div class="line">  sock-&gt;write(part2); <span class="comment">// may yield</span></div><div class="line">  sock-&gt;write(part3); <span class="comment">// may yield</span></div><div class="line">}</div></div><!-- fragment --><p>The output could look something like:</p>
<div class="fragment"><div class="line">part1</div><div class="line">part2</div><div class="line">part1</div><div class="line">part3</div><div class="line">part2</div><div class="line">part3</div></div><!-- fragment --><p>What you want to happen is this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> write_message() {</div><div class="line">  boost::unique_lock&lt;fc::mutex&gt; <a class="code" href="classfc_1_1mutex.html#ad27acb6182f2c9999c2ac2d2463077c7">lock</a>(sock-&gt;write_lock);</div><div class="line">  sock-&gt;write(part1); <span class="comment">// may yield</span></div><div class="line">  sock-&gt;write(part2); <span class="comment">// may yield</span></div><div class="line">  sock-&gt;write(part3); <span class="comment">// may yield</span></div><div class="line">}</div></div><!-- fragment --><p>Now if while writing the first message, someone attempts to write a second message second write will 'queue' behind the first by 'blocking' on the mutex.</p>
<p>As a result we now have to extend the normal discussion on thread-safe vs reentrant.</p>
<ul>
<li>prempt-thread-safe : the code may be called by multiple os threads at the same time.</li>
<li>coop-thread-safe : the code may be called by multiple contexts within the same thread.</li>
<li>thread-unsafe : the code may only be called by one context at a time for a set of data.</li>
</ul>
<p>In the example above, before we added the mutex the code was thread-unsafe After we added the mutex the code became coop-thread-safe, and potentially prempt-thread-safe</p>
<p>To be preempt-thread-safe any operations must be atomic or protected by a lock because the OS could switch you out between any two instructions.</p>
<p>To be coop-thread-safe all operations are 'atomic' unless they span a 'yield'. If they span a yield (such as writing parts of a message), then a mutex is required. </p>

<p class="definition">Definition at line <a class="el" href="mutex_8hpp_source.html#l00091">91</a> of file <a class="el" href="mutex_8hpp_source.html">mutex.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ac22379059fe8687ec5beb098ca606060"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac22379059fe8687ec5beb098ca606060">&#9670;&nbsp;</a></span>mutex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fc::mutex::mutex </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mutex_8cpp_source.html#l00010">10</a> of file <a class="el" href="mutex_8cpp_source.html">mutex.cpp</a>.</p>

</div>
</div>
<a id="a135d5ee5d0422e223d0956caa928761b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a135d5ee5d0422e223d0956caa928761b">&#9670;&nbsp;</a></span>~mutex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fc::mutex::~mutex </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mutex_8cpp_source.html#l00015">15</a> of file <a class="el" href="mutex_8cpp_source.html">mutex.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ad27acb6182f2c9999c2ac2d2463077c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad27acb6182f2c9999c2ac2d2463077c7">&#9670;&nbsp;</a></span>lock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fc::mutex::lock </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mutex_8cpp_source.html#l00136">136</a> of file <a class="el" href="mutex_8cpp_source.html">mutex.cpp</a>.</p>

</div>
</div>
<a id="a6ee1f956f3714d91df52a736b496d993"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ee1f956f3714d91df52a736b496d993">&#9670;&nbsp;</a></span>try_lock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool fc::mutex::try_lock </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A mutex is considered to hold the lock when the current context is the tail in the wait queue. </p>

<p class="definition">Definition at line <a class="el" href="mutex_8cpp_source.html#l00083">83</a> of file <a class="el" href="mutex_8cpp_source.html">mutex.cpp</a>.</p>

</div>
</div>
<a id="a992f444812ae4faebe485f3131d8a10b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a992f444812ae4faebe485f3131d8a10b">&#9670;&nbsp;</a></span>try_lock_for()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool fc::mutex::try_lock_for </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classfc_1_1microseconds.html">microseconds</a> &amp;&#160;</td>
          <td class="paramname"><em>rel_time</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a6c203a83ae29c8566a5bbbc07bc33931"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c203a83ae29c8566a5bbbc07bc33931">&#9670;&nbsp;</a></span>try_lock_until()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool fc::mutex::try_lock_until </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classfc_1_1time__point.html">time_point</a> &amp;&#160;</td>
          <td class="paramname"><em>abs_time</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mutex_8cpp_source.html#l00101">101</a> of file <a class="el" href="mutex_8cpp_source.html">mutex.cpp</a>.</p>

</div>
</div>
<a id="a9631571a059b48fe90022923795bfab4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9631571a059b48fe90022923795bfab4">&#9670;&nbsp;</a></span>unlock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fc::mutex::unlock </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mutex_8cpp_source.html#l00194">194</a> of file <a class="el" href="mutex_8cpp_source.html">mutex.cpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>libraries/fc/include/fc/thread/<a class="el" href="mutex_8hpp_source.html">mutex.hpp</a></li>
<li>libraries/fc/src/thread/<a class="el" href="mutex_8cpp_source.html">mutex.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Dec 1 2022 10:13:46 for BitShares-Core by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
